<!DOCTYPE html>
<html>
<head>
    <title>Arcticus</title>
    <script src="js/jquery.min.js"></script>
    <script src="js/vue.min.js"></script>
    <style>
        main {
            position: absolute;
            top: 0; bottom: 0;
            left: 0; right: 0;
        }

        .slider {
            z-index: 1000;
            text-align: center;
            position: absolute;
            left: 0; right: 0;
            top: 0;
        }

        .slider * {
            width: 100%;
        }

        .left {
            position: absolute;
            top: 3em; bottom: 0;
            left: 0; right: 50%;
        }

        .left img {
            width: 100%;
            height: 100%;
        }

        .right {
            position: absolute;
            top: 3em; bottom: 0;
            left: 50%; right: 0;
        }

        .right #map {
            border: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <main>
        <div class="slider">
            <input type="range" v-model="time_idx" min="0" :max="northern.length-1"></input><br/>
            <b>Year: {{northern[time_idx].year}}, Area: {{northern[time_idx].area}}</b>
        </div>
        <div class="left">
            <img :src="northern[time_idx].png"/>
        </div>
        <div class="right">
            <div id="map"></div>
        </div>
    </main>
    <script>
        var vm = new Vue({
            el: "main",
            data: {
                time_idx: 0,
                latitude: 42.360566899999995,
                longitude: -71.0890496,
                northern: false,
                state: {
                    map: false,
                    circle: false
                }
            },
            watch: {
                time_idx: function (val, old) {
                    var self = this;
                    self.state.circle.setRadius(self.northern[val].radius);
                }
            },
            created: function () {
                var self = this;
                $.get("data/processed/entries.json", function (northern) {
                    self.northern = northern;
                    self.state.circle.setRadius(self.northern[0].radius);
                });
                navigator.geolocation.getCurrentPosition(function (res) {
                    self.latitude = res.coords.latitude;
                    self.longitude = res.coords.longitude;
                }, alert);
            }
        });
        
        function initMap() {
            setTimeout(function() {
                vm.state.map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 14,
                    center: {lat: 42.360566899999995, lng: -71.0890496},
                    mapTypeId: 'terrain'
                });
                vm.state.circle = new google.maps.Circle({
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.35,
                    map: vm.state.map,
                    center: {lat: 42.360566899999995, lng: -71.0890496},
                    radius: 0.0
                });

                for (var i = 0; i < vm.northern.length; i++) {
                    var img = new Image();
                    img.src = vm.northern[i].png;
                }
            }, 1000)
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAuDY2gpfB5QfkmwJVZCxWnz9CmyvAJfjk&callback=initMap"></script>
</body>
</html>
